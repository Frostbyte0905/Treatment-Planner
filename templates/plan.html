{% extends "base.html" %}
{% block content %}
<section class="plan-header">
  <div>
    <h2>Treatment Plan</h2>
    {% if patient_name %}<p><strong>Patient:</strong> {{ patient_name }}</p>{% endif %}
    <p><strong>Insurance maximum:</strong> {{ insurance_max }} {% if max_reached %}<span class="tag">Max reached</span>{% endif %}</p>
  </div>
  <div class="tooth-diagram">
    <figure>
      <img
        src="{{ url_for('static', filename='teeth.jpg') }}"
        alt="Tooth number reference"
        loading="lazy"
        decoding="async">
      <figcaption>Tooth numbers for reference</figcaption>
    </figure>
  </div>
</section>

<section class="card">
  <div class="table-wrap">
    <table class="plan-table">
      <!-- Column width control -->
      <colgroup>
        <col class="col-proc">
        <col class="col-tooth">
        <col class="col-reason">
        <col class="col-cost">
        <col class="col-ins">
        <col class="col-pat">
        <col class="col-month">
      </colgroup>

      <thead>
        <tr>
          <th>Procedure</th>
          <th>Tooth</th>
          <th>Reason</th>
          <th>Cost</th>
          <th>Est. Insurance Coverage*</th>
          <th>Est. Patient Responsibility</th>
          <th>Est. Monthly <span class="nowrap">(48 mo @ 15%)**</span></th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.display_name }}</td>
          <td>{{ r.tooth }}</td>
          <td>{{ r.reason }}</td>
          <td>{{ r.cost }}</td>
          <td>{{ r.insurance_pay }}</td>
          <td>{{ r.patient_pay }}</td>
          <td>{{ r.monthly_est }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="5" class="right">Total paid by insurance</th>
          <th colspan="2">{{ insurance_total }}</th>
        </tr>
        <tr>
          <th colspan="5" class="right">Total paid by patient</th>
          <th colspan="2">{{ patient_total }}</th>
        </tr>
      </tfoot>
    </table>
  </div>

  {% if notes %}
  <div class="notes">
    <h3>Notes</h3>
    <p>{{ notes }}</p>
  </div>
  {% endif %}

  <div class="disclaimer">
    <p>
      * This plan is an estimate based on the coverage percentages provided. Final patient responsibility may change if insurance benefits, deductibles, waiting periods, or plan limitations apply.<br>
      ** Monthly payment amounts are estimates only and will vary based on credit approval, exact interest rate, and lender terms.
    </p>
  </div>

  <div class="print-actions">
    <button class="btn" onclick="window.print()">Print</button>
    <a class="btn" href="{{ url_for('edit') }}">Edit</a>
    <a class="btn" href="{{ url_for('index') }}">Start a new plan</a>
  </div>
</section>
{% endblock %}
